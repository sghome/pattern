<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Análisis de Patrones de Chladni desde MIDI</title>
    <!-- Incluir la biblioteca P5.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.js"></script>
    <!-- Incluir la biblioteca Tone.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.26/Tone.js"></script>
</head>
<body>
    <h1>Análisis de Patrones de Chladni desde MIDI</h1>
    <!-- Crear un botón para cargar y analizar el archivo MIDI -->
    <button onclick="startAnalysis()">Cargar y Analizar MIDI</button>
    <!-- Crear un lienzo donde se dibujarán los patrones -->
    <div id="canvas-container"></div>

    <script>
        // Función para cargar y analizar el archivo MIDI después de una interacción del usuario
        function startAnalysis() {
            // Configurar el audio y cargar el archivo MP3
            audioSetup('https://sghome.github.io/mp3/go.mp3');
            // Cargar y analizar el archivo MIDI después de un corto retraso para asegurarse de que el contexto de audio se inicie
            setTimeout(loadAndAnalyzeMIDI, 100);
        }

        // Función para cargar y analizar el archivo MIDI
        function loadAndAnalyzeMIDI() {
            // Cargar el archivo MIDI desde la URL
            MIDI.Player.loadFile(
                "https://sghome.github.io/mp3/go.mid",
                function() {
                    // Obtener las notas y frecuencias del archivo MIDI
                    let notes = MIDI.Player.getSongNotes();
                    let frequencies = notes.map(note => Tone.Frequency(note).toFrequency());

                    // Llamar a la función para generar los patrones de Chladni
                    generateChladniPatterns(frequencies);
                }
            );
        }

        // Función para configurar el audio y cargar el archivo MP3
        function audioSetup(mp3URL) {
            // Crear un objeto Audio
            let audio = new Audio(mp3URL);
            // Reproducir el audio (opcional)
            audio.play();
        }

        // Función para generar los patrones de Chladni
        function generateChladniPatterns(frequencies) {
            // Definir el lienzo P5.js
            let canvas;

            // Función de configuración inicial de P5.js
            function setup() {
                // Crear un lienzo P5.js
                canvas = createCanvas(800, 600);
                background(255);

                // Generar y visualizar los patrones de Chladni
                generateChladni(frequencies);
            }

            // Función para generar y visualizar los patrones de Chladni
            function generateChladni(frequencies) {
                // Lógica para generar y visualizar los patrones de Chladni
                // Utiliza P5.js para dibujar los patrones en el lienzo
                let numNotes = frequencies.length;
                let margin = 20;
                let startX = margin;
                let endX = width - margin;
                let startY = margin;
                let endY = height - margin;
                let stepX = (endX - startX) / (numNotes - 1);

                // Dibujar círculos según las frecuencias
                for (let i = 0; i < numNotes; i++) {
                    let x = startX + i * stepX;
                    let y = map(frequencies[i], 0, 2000, endY, startY); // Ajusta los valores máximos y mínimos según tus necesidades
                    ellipse(x, y, 10, 10); // Dibuja un círculo en la posición calculada
                }
            }
        }
    </script>
</body>
</html>
